<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anomaly Detection & Market Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #000;
            font-family: 'Monaco', 'Courier New', monospace;
        }
        
        .anomaly-glow {
            animation: anomalyPulse 2s infinite;
        }
        
        @keyframes anomalyPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 68, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 0, 68, 0.8); }
        }
        
        .dark-flow {
            background: linear-gradient(135deg, #1a0033 0%, #330011 100%);
            border: 1px solid rgba(138, 43, 226, 0.3);
        }
        
        .anomaly-card {
            background: rgba(10, 0, 20, 0.9);
            border: 1px solid rgba(255, 0, 68, 0.2);
            transition: all 0.3s;
        }
        
        .anomaly-card:hover {
            border-color: rgba(255, 0, 68, 0.5);
            transform: translateY(-2px);
        }
        
        .cycle-indicator {
            background: conic-gradient(from 0deg, #00ff88, #0088ff, #ff0044, #ffaa00, #00ff88);
            mask: radial-gradient(farthest-side, transparent calc(100% - 8px), white calc(100% - 7px));
            -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 8px), white calc(100% - 7px));
        }
        
        .trend-line {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: draw 2s forwards;
        }
        
        @keyframes draw {
            to { stroke-dashoffset: 0; }
        }
        
        .alert-badge {
            animation: alertFlash 1s infinite;
        }
        
        @keyframes alertFlash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .data-stream {
            font-family: 'Monaco', monospace;
            font-size: 10px;
            color: #00ff88;
            opacity: 0.7;
        }
        
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #000;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 0, 68, 0.3);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 0, 68, 0.5);
        }
    </style>
</head>
<body class="text-gray-100 min-h-screen">
    <!-- Header -->
    <nav class="bg-black border-b border-red-900/50 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-14 flex items-center justify-between">
            <div class="flex items-center space-x-6">
                <h1 class="text-lg font-bold">
                    <span class="text-red-500">ANOMALY</span>
                    <span class="text-gray-500">SCANNER</span>
                </h1>
                <div class="flex items-center space-x-4 text-xs">
                    <button onclick="setView('darkflow')" class="px-3 py-1 hover:text-red-400 transition-colors">Dark Flow</button>
                    <button onclick="setView('anomalies')" class="px-3 py-1 hover:text-red-400 transition-colors">Anomalies</button>
                    <button onclick="setView('cycles')" class="px-3 py-1 hover:text-red-400 transition-colors">Cycles</button>
                    <button onclick="setView('trends')" class="px-3 py-1 hover:text-red-400 transition-colors">Trends</button>
                    <button onclick="setView('alerts')" class="px-3 py-1 hover:text-red-400 transition-colors">Alerts</button>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-xs text-red-400 alert-badge">● 17 NEW ANOMALIES</span>
                <span class="text-xs text-gray-500" id="timestamp">--:--:--</span>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-4">
        <!-- Real-time Anomaly Feed -->
        <div class="mb-4 p-3 bg-red-900/10 border border-red-900/30 rounded">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-2 h-2 bg-red-500 rounded-full alert-badge"></div>
                    <span class="text-sm font-semibold text-red-400">CRITICAL ANOMALY DETECTED</span>
                    <span class="text-xs text-gray-500">2 min ago</span>
                </div>
                <div class="text-sm">
                    <span class="text-gray-400">SPY:</span>
                    <span class="text-red-400 font-bold">3.2σ dark pool spike</span>
                    <span class="text-gray-400 ml-2">$2.3B notional</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent">
            <!-- Dark Flow View -->
            <div id="darkflow-content" class="space-y-4">
                <div class="grid grid-cols-3 gap-4">
                    <!-- Recent Dark Pool Activity -->
                    <div class="col-span-2 dark-flow rounded-lg p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-semibold text-purple-400">DARK POOL FLOW - LAST 24H</h3>
                            <div class="flex space-x-2">
                                <button class="text-xs px-2 py-1 rounded bg-purple-900/50 hover:bg-purple-900 text-purple-400">BLOCKS</button>
                                <button class="text-xs px-2 py-1 rounded bg-purple-900/50 hover:bg-purple-900 text-purple-400">SWEEPS</button>
                                <button class="text-xs px-2 py-1 rounded bg-purple-900/50 hover:bg-purple-900 text-purple-400">SPLITS</button>
                            </div>
                        </div>
                        <div id="darkPoolChart" style="height: 350px;"></div>
                    </div>

                    <!-- Top Dark Pool Prints -->
                    <div class="dark-flow rounded-lg p-4">
                        <h3 class="text-sm font-semibold text-purple-400 mb-4">UNUSUAL PRINTS</h3>
                        <div class="space-y-2 max-h-80 overflow-y-auto" id="darkPrints">
                            <!-- Dark prints will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Dark Pool Heatmap -->
                <div class="dark-flow rounded-lg p-4">
                    <h3 class="text-sm font-semibold text-purple-400 mb-4">SECTOR DARK FLOW HEATMAP</h3>
                    <div id="darkHeatmap" style="height: 300px;"></div>
                </div>
            </div>

            <!-- Anomalies View -->
            <div id="anomalies-content" class="hidden space-y-4">
                <div class="grid grid-cols-4 gap-3 mb-4">
                    <div class="anomaly-card rounded p-3">
                        <div class="text-xs text-gray-500 mb-1">Volume Spike</div>
                        <div class="text-xl font-bold text-red-400">14</div>
                        <div class="text-xs text-gray-400">+8 vs avg</div>
                    </div>
                    <div class="anomaly-card rounded p-3">
                        <div class="text-xs text-gray-500 mb-1">Price Deviation</div>
                        <div class="text-xl font-bold text-orange-400">7</div>
                        <div class="text-xs text-gray-400">&gt;2.5σ moves</div>
                    </div>
                    <div class="anomaly-card rounded p-3">
                        <div class="text-xs text-gray-500 mb-1">Options Unusual</div>
                        <div class="text-xl font-bold text-yellow-400">23</div>
                        <div class="text-xs text-gray-400">OI changes</div>
                    </div>
                    <div class="anomaly-card rounded p-3">
                        <div class="text-xs text-gray-500 mb-1">Correlation Break</div>
                        <div class="text-xl font-bold text-purple-400">5</div>
                        <div class="text-xs text-gray-400">Pair divergence</div>
                    </div>
                </div>

                <!-- Anomaly Detection Chart -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="anomaly-card rounded-lg p-4">
                        <h3 class="text-sm font-semibold text-red-400 mb-4">ANOMALY DETECTION MATRIX</h3>
                        <div id="anomalyMatrix" style="height: 400px;"></div>
                    </div>
                    <div class="anomaly-card rounded-lg p-4">
                        <h3 class="text-sm font-semibold text-red-400 mb-4">Z-SCORE DISTRIBUTION</h3>
                        <div id="zscoreChart" style="height: 400px;"></div>
                    </div>
                </div>

                <!-- Recent Anomalies List -->
                <div class="anomaly-card rounded-lg p-4">
                    <h3 class="text-sm font-semibold text-red-400 mb-4">RECENT ANOMALIES</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-xs">
                            <thead>
                                <tr class="border-b border-red-900/30">
                                    <th class="text-left py-2">Time</th>
                                    <th class="text-left py-2">Symbol</th>
                                    <th class="text-left py-2">Type</th>
                                    <th class="text-left py-2">Magnitude</th>
                                    <th class="text-left py-2">Description</th>
                                    <th class="text-left py-2">Action</th>
                                </tr>
                            </thead>
                            <tbody id="anomaliesTable">
                                <!-- Anomalies will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Cycles View -->
            <div id="cycles-content" class="hidden space-y-4">
                <div class="grid grid-cols-3 gap-4">
                    <!-- Market Cycles -->
                    <div class="col-span-2 bg-gray-900 border border-gray-800 rounded-lg p-4">
                        <h3 class="text-sm font-semibold text-blue-400 mb-4">DOMINANT MARKET CYCLES</h3>
                        <div id="cyclesChart" style="height: 400px;"></div>
                    </div>

                    <!-- Cycle Indicators -->
                    <div class="bg-gray-900 border border-gray-800 rounded-lg p-4">
                        <h3 class="text-sm font-semibold text-blue-400 mb-4">CYCLE PHASE</h3>
                        <div class="flex justify-center mb-4">
                            <div class="cycle-indicator w-32 h-32 rounded-full relative">
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold">67°</div>
                                        <div class="text-xs text-gray-400">Expansion</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="bg-black p-2 rounded">
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-400">20-Day</span>
                                    <span class="text-green-400">Bullish</span>
                                </div>
                                <div class="w-full bg-gray-800 h-1 rounded mt-1">
                                    <div class="bg-green-400 h-1 rounded" style="width: 72%"></div>
                                </div>
                            </div>
                            <div class="bg-black p-2 rounded">
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-400">40-Day</span>
                                    <span class="text-yellow-400">Neutral</span>
                                </div>
                                <div class="w-full bg-gray-800 h-1 rounded mt-1">
                                    <div class="bg-yellow-400 h-1 rounded" style="width: 48%"></div>
                                </div>
                            </div>
                            <div class="bg-black p-2 rounded">
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-400">80-Day</span>
                                    <span class="text-blue-400">Early</span>
                                </div>
                                <div class="w-full bg-gray-800 h-1 rounded mt-1">
                                    <div class="bg-blue-400 h-1 rounded" style="width: 23%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fourier Analysis -->
                <div class="bg-gray-900 border border-gray-800 rounded-lg p-4">
                    <h3 class="text-sm font-semibold text-blue-400 mb-4">SPECTRAL ANALYSIS - DOMINANT FREQUENCIES</h3>
                    <div id="fourierChart" style="height: 300px;"></div>
                </div>
            </div>

            <!-- Trends View -->
            <div id="trends-content" class="hidden space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <!-- Trend Strength -->
                    <div class="bg-gray-900 border border-gray-800 rounded-lg p-4">
                        <h3 class="text-sm font-semibold text-green-400 mb-4">TREND STRENGTH ANALYSIS</h3>
                        <div id="trendStrength" style="height: 350px;"></div>
                    </div>

                    <!-- Regime Detection -->
                    <div class="bg-gray-900 border border-gray-800 rounded-lg p-4">
                        <h3 class="text-sm font-semibold text-green-400 mb-4">MARKET REGIME</h3>
                        <div id="regimeChart" style="height: 350px;"></div>
                    </div>
                </div>

                <!-- Trend Channels -->
                <div class="bg-gray-900 border border-gray-800 rounded-lg p-4">
                    <h3 class="text-sm font-semibold text-green-400 mb-4">DYNAMIC TREND CHANNELS</h3>
                    <div id="trendChannels" style="height: 400px;"></div>
                </div>

                <!-- Momentum Dashboard -->
                <div class="grid grid-cols-4 gap-3">
                    <div class="bg-gray-900 border border-gray-800 rounded p-3">
                        <div class="text-xs text-gray-500 mb-1">Short-term</div>
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-green-400">↑ 2.3%</span>
                            <span class="text-xs text-gray-400">5D</span>
                        </div>
                    </div>
                    <div class="bg-gray-900 border border-gray-800 rounded p-3">
                        <div class="text-xs text-gray-500 mb-1">Medium-term</div>
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-yellow-400">→ 0.8%</span>
                            <span class="text-xs text-gray-400">20D</span>
                        </div>
                    </div>
                    <div class="bg-gray-900 border border-gray-800 rounded p-3">
                        <div class="text-xs text-gray-500 mb-1">Long-term</div>
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-green-400">↑ 8.7%</span>
                            <span class="text-xs text-gray-400">60D</span>
                        </div>
                    </div>
                    <div class="bg-gray-900 border border-gray-800 rounded p-3">
                        <div class="text-xs text-gray-500 mb-1">Momentum</div>
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-blue-400">73</span>
                            <span class="text-xs text-gray-400">RSI</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alerts View -->
            <div id="alerts-content" class="hidden space-y-4">
                <!-- Alert Configuration -->
                <div class="bg-gray-900 border border-gray-800 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-semibold text-orange-400">ACTIVE ALERT RULES</h3>
                        <button class="text-xs bg-orange-900 hover:bg-orange-800 px-3 py-1 rounded text-orange-400">
                            + NEW RULE
                        </button>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="bg-black p-3 rounded border border-orange-900/30">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-semibold">Dark Pool &gt; $1B</span>
                                <button class="text-green-400 text-xs">ON</button>
                            </div>
                            <div class="text-xs text-gray-400">Triggered 3 times today</div>
                        </div>
                        <div class="bg-black p-3 rounded border border-orange-900/30">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-semibold">3σ Price Move</span>
                                <button class="text-green-400 text-xs">ON</button>
                            </div>
                            <div class="text-xs text-gray-400">Triggered 7 times today</div>
                        </div>
                        <div class="bg-black p-3 rounded border border-orange-900/30">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-semibold">Correlation Break</span>
                                <button class="text-green-400 text-xs">ON</button>
                            </div>
                            <div class="text-xs text-gray-400">Triggered 1 time today</div>
                        </div>
                    </div>
                </div>

                <!-- Alert History -->
                <div class="bg-gray-900 border border-gray-800 rounded-lg p-4">
                    <h3 class="text-sm font-semibold text-orange-400 mb-4">ALERT HISTORY</h3>
                    <div class="space-y-2 max-h-96 overflow-y-auto" id="alertHistory">
                        <!-- Alert history will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Data Stream -->
        <div class="fixed bottom-4 right-4 bg-black border border-gray-800 rounded p-3 w-80 data-stream">
            <div class="text-xs text-green-400 mb-2">LIVE STREAM</div>
            <div id="dataStream" class="space-y-1 h-32 overflow-hidden">
                <!-- Live data will stream here -->
            </div>
        </div>
    </div>

    <script>
        let currentView = 'darkflow';
        let charts = {};
        let streamInterval;
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeDarkFlow();
            setView('darkflow');
            startLiveStream();
            updateTimestamp();
        });
        
        function setView(view) {
            currentView = view;
            
            // Hide all content
            document.querySelectorAll('[id$="-content"]').forEach(el => el.classList.add('hidden'));
            
            // Show selected content
            document.getElementById(`${view}-content`).classList.remove('hidden');
            
            // Initialize view-specific content
            switch(view) {
                case 'darkflow':
                    initializeDarkFlow();
                    break;
                case 'anomalies':
                    initializeAnomalies();
                    break;
                case 'cycles':
                    initializeCycles();
                    break;
                case 'trends':
                    initializeTrends();
                    break;
                case 'alerts':
                    initializeAlerts();
                    break;
            }
        }
        
        function initializeDarkFlow() {
            // Dark Pool Flow Chart
            if (!charts.darkPool) {
                charts.darkPool = new ApexCharts(document.querySelector("#darkPoolChart"), {
                    series: [
                        {
                            name: 'Dark Pool Buy',
                            type: 'column',
                            data: generateDarkPoolData(24, 0, 500)
                        },
                        {
                            name: 'Dark Pool Sell',
                            type: 'column',
                            data: generateDarkPoolData(24, -500, 0)
                        },
                        {
                            name: 'Net Flow',
                            type: 'line',
                            data: generateDarkPoolData(24, -200, 200)
                        }
                    ],
                    chart: {
                        height: 350,
                        type: 'line',
                        toolbar: { show: false },
                        background: 'transparent'
                    },
                    stroke: { width: [0, 0, 2] },
                    colors: ['#8a2be2', '#ff1493', '#00ff88'],
                    plotOptions: {
                        bar: { columnWidth: '80%' }
                    },
                    xaxis: {
                        categories: generateHourLabels(24),
                        labels: { style: { colors: '#666' } }
                    },
                    yaxis: {
                        labels: { 
                            style: { colors: '#666' },
                            formatter: (v) => '$' + Math.abs(v) + 'M'
                        }
                    },
                    theme: { mode: 'dark' },
                    grid: { borderColor: '#222' },
                    legend: { labels: { colors: '#999' } }
                });
                charts.darkPool.render();
            }
            
            // Dark Pool Heatmap
            if (!document.querySelector("#darkHeatmap")._plotly) {
                const sectors = ['Tech', 'Finance', 'Healthcare', 'Energy', 'Consumer', 'Industrial'];
                const times = generateHourLabels(24);
                const z = [];
                
                for (let i = 0; i < sectors.length; i++) {
                    const row = [];
                    for (let j = 0; j < times.length; j++) {
                        row.push(Math.random() * 100);
                    }
                    z.push(row);
                }
                
                const data = [{
                    x: times,
                    y: sectors,
                    z: z,
                    type: 'heatmap',
                    colorscale: [
                        [0, '#000'],
                        [0.5, '#8a2be2'],
                        [1, '#ff1493']
                    ],
                    showscale: false
                }];
                
                const layout = {
                    paper_bgcolor: 'transparent',
                    plot_bgcolor: 'transparent',
                    font: { color: '#666', size: 10 },
                    xaxis: { side: 'bottom' },
                    yaxis: { autorange: 'reversed' },
                    margin: { t: 20, b: 40, l: 60, r: 20 }
                };
                
                Plotly.newPlot('darkHeatmap', data, layout, {responsive: true});
            }
            
            // Load Dark Prints
            loadDarkPrints();
        }
        
        function loadDarkPrints() {
            const prints = [
                { time: '09:32:14', symbol: 'SPY', size: '$2.3B', price: 452.18, type: 'SWEEP' },
                { time: '09:28:41', symbol: 'QQQ', size: '$1.8B', price: 378.92, type: 'BLOCK' },
                { time: '09:25:33', symbol: 'TSLA', size: '$892M', price: 238.45, type: 'SPLIT' },
                { time: '09:21:17', symbol: 'NVDA', size: '$1.2B', price: 487.23, type: 'SWEEP' },
                { time: '09:18:52', symbol: 'AAPL', size: '$743M', price: 172.34, type: 'BLOCK' },
                { time: '09:15:28', symbol: 'META', size: '$521M', price: 312.18, type: 'SWEEP' },
                { time: '09:12:44', symbol: 'AMZN', size: '$438M', price: 142.76, type: 'SPLIT' }
            ];
            
            const container = document.getElementById('darkPrints');
            container.innerHTML = prints.map(print => `
                <div class="bg-black p-2 rounded border border-purple-900/30 hover:border-purple-500/50 cursor-pointer">
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="font-bold text-sm">${print.symbol}</span>
                            <span class="text-xs text-gray-500 ml-2">${print.time}</span>
                        </div>
                        <span class="text-xs px-1 py-0.5 rounded bg-purple-900/50 text-purple-400">
                            ${print.type}
                        </span>
                    </div>
                    <div class="flex justify-between text-xs mt-1">
                        <span class="text-purple-400">${print.size}</span>
                        <span class="text-gray-400">@${print.price}</span>
                    </div>
                </div>
            `).join('');
        }
        
        function initializeAnomalies() {
            // Anomaly Matrix
            if (!charts.anomalyMatrix) {
                const trace = {
                    x: generateTimeData(100),
                    y: generateRandomData(100, -4, 4),
                    mode: 'markers',
                    marker: {
                        size: generateRandomData(100, 5, 20),
                        color: generateRandomData(100, -4, 4),
                        colorscale: [
                            [0, '#00ff88'],
                            [0.5, '#ffaa00'],
                            [1, '#ff0044']
                        ],
                        showscale: true,
                        colorbar: {
                            title: 'Z-Score',
                            titlefont: { color: '#666' },
                            tickfont: { color: '#666' }
                        }
                    },
                    type: 'scatter'
                };
                
                const layout = {
                    paper_bgcolor: 'transparent',
                    plot_bgcolor: 'transparent',
                    font: { color: '#666' },
                    xaxis: { gridcolor: '#222', title: 'Time' },
                    yaxis: { gridcolor: '#222', title: 'Standard Deviations' },
                    margin: { t: 20, b: 40, l: 40, r: 60 }
                };
                
                Plotly.newPlot('anomalyMatrix', [trace], layout, {responsive: true});
            }
            
            // Z-Score Distribution
            if (!charts.zscore) {
                charts.zscore = new ApexCharts(document.querySelector("#zscoreChart"), {
                    series: [{
                        name: 'Distribution',
                        data: generateNormalDistribution()
                    }],
                    chart: {
                        type: 'area',
                        height: 400,
                        toolbar: { show: false },
                        background: 'transparent'
                    },
                    fill: {
                        type: 'gradient',
                        gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.7,
                            opacityTo: 0.3,
                            stops: [0, 90, 100]
                        }
                    },
                    stroke: { curve: 'smooth', width: 2 },
                    colors: ['#ff0044'],
                    xaxis: { 
                        categories: generateZScoreLabels(),
                        labels: { style: { colors: '#666' } }
                    },
                    yaxis: { labels: { style: { colors: '#666' } } },
                    theme: { mode: 'dark' },
                    grid: { borderColor: '#222' },
                    annotations: {
                        xaxis: [
                            {
                                x: -3,
                                x2: -2,
                                fillColor: '#ff0044',
                                opacity: 0.1,
                                label: { text: 'Extreme', style: { color: '#ff0044' } }
                            },
                            {
                                x: 2,
                                x2: 3,
                                fillColor: '#ff0044',
                                opacity: 0.1,
                                label: { text: 'Extreme', style: { color: '#ff0044' } }
                            }
                        ]
                    }
                });
                charts.zscore.render();
            }
            
            // Load anomalies table
            loadAnomaliesTable();
        }
        
        function loadAnomaliesTable() {
            const anomalies = [
                { time: '14:32:18', symbol: 'VIX', type: 'Spike', magnitude: '3.8σ', desc: 'Volatility surge without catalyst', action: 'Monitor' },
                { time: '14:28:41', symbol: 'SPY-QQQ', type: 'Correlation', magnitude: '2.5σ', desc: 'Pair correlation breakdown', action: 'Alert' },
                { time: '14:21:33', symbol: 'TSLA', type: 'Volume', magnitude: '4.2σ', desc: '5x average volume spike', action: 'Investigate' },
                { time: '14:15:52', symbol: 'GLD-DXY', type: 'Divergence', magnitude: '2.1σ', desc: 'Unusual inverse break', action: 'Monitor' },
                { time: '14:08:17', symbol: 'IWM', type: 'Price', magnitude: '2.8σ', desc: 'Rapid movement on low volume', action: 'Alert' }
            ];
            
            const tbody = document.getElementById('anomaliesTable');
            tbody.innerHTML = anomalies.map(a => `
                <tr class="border-b border-red-900/30 hover:bg-red-900/10">
                    <td class="py-2">${a.time}</td>
                    <td class="py-2 font-bold">${a.symbol}</td>
                    <td class="py-2">
                        <span class="px-2 py-0.5 rounded text-xs bg-red-900/30 text-red-400">
                            ${a.type}
                        </span>
                    </td>
                    <td class="py-2 text-orange-400">${a.magnitude}</td>
                    <td class="py-2 text-gray-400">${a.desc}</td>
                    <td class="py-2">
                        <button class="text-xs px-2 py-0.5 rounded bg-red-900/30 hover:bg-red-900/50 text-red-400">
                            ${a.action}
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        function initializeCycles() {
            // Market Cycles Chart
            if (!charts.cycles) {
                charts.cycles = new ApexCharts(document.querySelector("#cyclesChart"), {
                    series: [
                        { name: '20-Day', data: generateSineWave(100, 20, 1) },
                        { name: '40-Day', data: generateSineWave(100, 40, 0.8) },
                        { name: '80-Day', data: generateSineWave(100, 80, 0.6) },
                        { name: 'Composite', data: generateCompositeCycle(100) }
                    ],
                    chart: {
                        type: 'line',
                        height: 400,
                        toolbar: { show: false },
                        background: 'transparent'
                    },
                    stroke: { curve: 'smooth', width: [1, 1, 1, 2] },
                    colors: ['#00ff88', '#0088ff', '#ff8800', '#ff0044'],
                    xaxis: { type: 'datetime', labels: { style: { colors: '#666' } } },
                    yaxis: { labels: { style: { colors: '#666' } } },
                    theme: { mode: 'dark' },
                    grid: { borderColor: '#222' },
                    legend: { labels: { colors: '#666' } }
                });
                charts.cycles.render();
            }
            
            // Fourier Analysis
            if (!charts.fourier) {
                charts.fourier = new ApexCharts(document.querySelector("#fourierChart"), {
                    series: [{
                        name: 'Power Spectrum',
                        data: generatePowerSpectrum()
                    }],
                    chart: {
                        type: 'bar',
                        height: 300,
                        toolbar: { show: false },
                        background: 'transparent'
                    },
                    plotOptions: {
                        bar: { columnWidth: '80%' }
                    },
                    colors: ['#0088ff'],
                    xaxis: { 
                        categories: ['5D', '10D', '20D', '40D', '60D', '80D', '120D', '200D'],
                        labels: { style: { colors: '#666' } }
                    },
                    yaxis: { 
                        labels: { 
                            style: { colors: '#666' },
                            formatter: (v) => v.toFixed(1)
                        }
                    },
                    theme: { mode: 'dark' },
                    grid: { borderColor: '#222' }
                });
                charts.fourier.render();
            }
        }
        
        function initializeTrends() {
            // Trend Strength
            if (!charts.trendStrength) {
                charts.trendStrength = new ApexCharts(document.querySelector("#trendStrength"), {
                    series: [
                        { name: 'Trend', data: generateTrendData() },
                        { name: 'Signal', data: generateSignalLine() }
                    ],
                    chart: {
                        type: 'line',
                        height: 350,
                        toolbar: { show: false },
                        background: 'transparent'
                    },
                    stroke: { curve: 'smooth', width: [3, 2] },
                    colors: ['#00ff88', '#ffaa00'],
                    xaxis: { type: 'datetime', labels: { style: { colors: '#666' } } },
                    yaxis: { labels: { style: { colors: '#666' } } },
                    theme: { mode: 'dark' },
                    grid: { borderColor: '#222' }
                });
                charts.trendStrength.render();
            }
            
            // Regime Chart
            if (!charts.regime) {
                charts.regime = new ApexCharts(document.querySelector("#regimeChart"), {
                    series: [{
                        name: 'Regime',
                        data: generateRegimeData()
                    }],
                    chart: {
                        type: 'area',
                        height: 350,
                        toolbar: { show: false },
                        background: 'transparent'
                    },
                    fill: {
                        type: 'gradient',
                        gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.7,
                            opacityTo: 0.3
                        }
                    },
                    stroke: { curve: 'stepline', width: 2 },
                    colors: ['#00ff88'],
                    xaxis: { type: 'datetime', labels: { style: { colors: '#666' } } },
                    yaxis: { 
                        labels: { 
                            style: { colors: '#666' },
                            formatter: (v) => ['Bear', 'Neutral', 'Bull'][Math.floor(v)]
                        },
                        min: 0,
                        max: 2
                    },
                    theme: { mode: 'dark' },
                    grid: { borderColor: '#222' }
                });
                charts.regime.render();
            }
            
            // Trend Channels
            if (!charts.channels) {
                charts.channels = new ApexCharts(document.querySelector("#trendChannels"), {
                    series: [
                        { name: 'Price', type: 'line', data: generatePriceData() },
                        { name: 'Upper', type: 'line', data: generateChannelData(1.02) },
                        { name: 'Lower', type: 'line', data: generateChannelData(0.98) }
                    ],
                    chart: {
                        height: 400,
                        type: 'line',
                        toolbar: { show: false },
                        background: 'transparent'
                    },
                    stroke: { 
                        curve: 'smooth', 
                        width: [2, 1, 1],
                        dashArray: [0, 5, 5]
                    },
                    colors: ['#00ff88', '#ff0044', '#ff0044'],
                    xaxis: { type: 'datetime', labels: { style: { colors: '#666' } } },
                    yaxis: { labels: { style: { colors: '#666' } } },
                    theme: { mode: 'dark' },
                    grid: { borderColor: '#222' },
                    legend: { labels: { colors: '#666' } }
                });
                charts.channels.render();
            }
        }
        
        function initializeAlerts() {
            loadAlertHistory();
        }
        
        function loadAlertHistory() {
            const alerts = [];
            const now = new Date();
            
            for (let i = 0; i < 50; i++) {
                const time = new Date(now.getTime() - i * 300000);
                const types = ['Dark Pool', 'Anomaly', 'Cycle', 'Trend', 'Volume'];
                const symbols = ['SPY', 'QQQ', 'VIX', 'TSLA', 'NVDA', 'AAPL'];
                
                alerts.push({
                    time: time.toTimeString().substr(0, 8),
                    type: types[Math.floor(Math.random() * types.length)],
                    symbol: symbols[Math.floor(Math.random() * symbols.length)],
                    message: 'Alert triggered for unusual activity'
                });
            }
            
            const container = document.getElementById('alertHistory');
            container.innerHTML = alerts.map(alert => `
                <div class="bg-black p-2 rounded border border-orange-900/30 hover:border-orange-500/50">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center space-x-2">
                            <span class="text-xs text-gray-500">${alert.time}</span>
                            <span class="text-xs px-1 py-0.5 rounded bg-orange-900/30 text-orange-400">
                                ${alert.type}
                            </span>
                            <span class="text-xs font-bold">${alert.symbol}</span>
                        </div>
                        <button class="text-xs text-gray-400 hover:text-white">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="text-xs text-gray-400 mt-1">${alert.message}</div>
                </div>
            `).join('');
        }
        
        // Helper functions
        function generateDarkPoolData(count, min, max) {
            const data = [];
            const now = new Date().getTime();
            for (let i = 0; i < count; i++) {
                data.push([now - (count - i) * 3600000, Math.random() * (max - min) + min]);
            }
            return data;
        }
        
        function generateHourLabels(count) {
            const labels = [];
            for (let i = 0; i < count; i++) {
                const hour = (9 + Math.floor(i / 2)) % 24;
                const minute = (i % 2) * 30;
                labels.push(`${hour}:${minute === 0 ? '00' : '30'}`);
            }
            return labels;
        }
        
        function generateTimeData(count) {
            const data = [];
            const now = new Date();
            for (let i = 0; i < count; i++) {
                data.push(new Date(now.getTime() - (count - i) * 3600000));
            }
            return data;
        }
        
        function generateRandomData(count, min, max) {
            const data = [];
            for (let i = 0; i < count; i++) {
                data.push(Math.random() * (max - min) + min);
            }
            return data;
        }
        
        function generateNormalDistribution() {
            const data = [];
            for (let x = -4; x <= 4; x += 0.1) {
                const y = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * x * x);
                data.push(y * 100);
            }
            return data;
        }
        
        function generateZScoreLabels() {
            const labels = [];
            for (let x = -4; x <= 4; x += 0.1) {
                labels.push(x.toFixed(1));
            }
            return labels;
        }
        
        function generateSineWave(count, period, amplitude) {
            const data = [];
            const now = new Date().getTime();
            for (let i = 0; i < count; i++) {
                const value = amplitude * Math.sin(2 * Math.PI * i / period);
                data.push([now - (count - i) * 86400000, value]);
            }
            return data;
        }
        
        function generateCompositeCycle(count) {
            const data = [];
            const now = new Date().getTime();
            for (let i = 0; i < count; i++) {
                const value = Math.sin(2 * Math.PI * i / 20) * 0.5 +
                              Math.sin(2 * Math.PI * i / 40) * 0.3 +
                              Math.sin(2 * Math.PI * i / 80) * 0.2;
                data.push([now - (count - i) * 86400000, value]);
            }
            return data;
        }
        
        function generatePowerSpectrum() {
            return [8.2, 5.1, 12.8, 9.3, 4.2, 3.1, 2.8, 1.9];
        }
        
        function generateTrendData() {
            const data = [];
            const now = new Date().getTime();
            let value = 100;
            for (let i = 0; i < 100; i++) {
                value += (Math.random() - 0.3) * 2;
                data.push([now - (100 - i) * 86400000, value]);
            }
            return data;
        }
        
        function generateSignalLine() {
            const trend = generateTrendData();
            const signal = [];
            for (let i = 0; i < trend.length; i++) {
                if (i < 10) {
                    signal.push([trend[i][0], trend[i][1]]);
                } else {
                    let sum = 0;
                    for (let j = i - 10; j < i; j++) {
                        sum += trend[j][1];
                    }
                    signal.push([trend[i][0], sum / 10]);
                }
            }
            return signal;
        }
        
        function generateRegimeData() {
            const data = [];
            const now = new Date().getTime();
            let regime = 1;
            
            for (let i = 0; i < 100; i++) {
                if (Math.random() > 0.95) {
                    regime = Math.floor(Math.random() * 3);
                }
                data.push([now - (100 - i) * 86400000, regime]);
            }
            return data;
        }
        
        function generatePriceData() {
            const data = [];
            const now = new Date().getTime();
            let price = 100;
            for (let i = 0; i < 50; i++) {
                price += (Math.random() - 0.48) * 2;
                data.push([now - (50 - i) * 86400000, price]);
            }
            return data;
        }
        
        function generateChannelData(multiplier) {
            const price = generatePriceData();
            return price.map(p => [p[0], p[1] * multiplier]);
        }
        
        function startLiveStream() {
            const stream = document.getElementById('dataStream');
            
            streamInterval = setInterval(() => {
                const messages = [
                    'DARK_POOL: SPY $452.18 BLOCK 500K',
                    'ANOMALY: VIX +2.3σ deviation detected',
                    'CYCLE: 20D entering overbought phase',
                    'TREND: QQQ breaking upper channel',
                    'FLOW: $1.2B institutional buy NVDA',
                    'ALERT: Correlation breakdown SPY-TLT',
                    'VOLUME: TSLA 3x average last 15min'
                ];
                
                const message = messages[Math.floor(Math.random() * messages.length)];
                const timestamp = new Date().toTimeString().substr(0, 8);
                
                const line = document.createElement('div');
                line.textContent = `[${timestamp}] ${message}`;
                line.style.opacity = '0';
                stream.insertBefore(line, stream.firstChild);
                
                // Animate in
                setTimeout(() => { line.style.opacity = '1'; }, 10);
                
                // Remove old lines
                while (stream.children.length > 10) {
                    stream.removeChild(stream.lastChild);
                }
            }, 3000);
        }
        
        function updateTimestamp() {
            setInterval(() => {
                const now = new Date();
                document.getElementById('timestamp').textContent = now.toTimeString().substr(0, 8);
            }, 1000);
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (streamInterval) clearInterval(streamInterval);
        });
    </script>
</body>
</html>